<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.roubao.modules.user.mapper.UserMapper">
    <select id="isSuperAdmin" resultType="java.lang.Integer" parameterType="java.lang.Integer">
        SELECT 1
        FROM user u
                 JOIN user_role ur ON u.id = ur.user_id
                 JOIN role r ON ur.role_id = r.id
        WHERE r.name = 'SuperAdmin'
          AND u.id = #{userId}
          AND u.status = 1
          AND r.status = 1 LIMIT 1
    </select>

    <select id="listUserAuthority" resultType="com.roubao.domain.AuthorityPO" parameterType="java.lang.Integer">
        SELECT a.id, a.auth_key, a.name, a.type, a.status
        FROM user u
                 JOIN user_role ur ON ur.user_id = u.id
                 JOIN role_authority ra ON ra.role_id = ur.role_id
                 JOIN authority a ON a.id = ra.authority_id
        WHERE u.id = #{userId}
          AND u.status = 1
          AND a.status = 1
        UNION ALL
        SELECT a.id, a.auth_key, a.name, a.type, a.status
        FROM user u
                 JOIN user_menu um ON um.user_id = u.id
                 JOIN menu_authority ma ON ma.menu_id = um.menu_id
                 JOIN authority a ON a.id = ma.authority_id
        WHERE u.id = #{userId}
          AND u.status = 1
          AND a.status = 1
    </select>

    <select id="listUserRole" resultType="com.roubao.domain.RolePO" parameterType="java.lang.Integer">
        SELECT r.id, r.name, r.status, r.create_time, r.update_time
        FROM user u
                 JOIN user_role ur ON u.id = ur.user_id
                 JOIN role r ON r.id = ur.role_id
        WHERE u.status = 1
          AND r.status = 1
    </select>
</mapper>